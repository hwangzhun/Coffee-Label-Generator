# 咖啡名片编辑器 - 宝塔面板部署详细指南

## 🎯 部署目标
将咖啡名片编辑器部署到使用宝塔面板的服务器上，实现在线访问。

## 📋 准备工作

### 服务器要求
- ✅ 宝塔面板已安装
- ✅ 服务器有公网IP或域名
- ✅ 至少1GB内存
- ✅ 至少10GB硬盘空间

### 本地准备
- ✅ 已打包的 `coffee-editor` 文件夹
- ✅ 服务器登录信息

## 🚀 详细部署步骤

### 第一步：上传文件

#### 方法1：通过宝塔面板上传
1. **登录宝塔面板**
   - 打开浏览器，访问：`http://您的服务器IP:8888`
   - 输入用户名和密码登录

2. **创建网站**
   - 点击左侧菜单"网站"
   - 点击"添加站点"
   - 填写域名（如：`coffee.yourdomain.com`）
   - 选择PHP版本（选择"纯静态"即可）
   - 点击"提交"

3. **上传文件**
   - 点击左侧菜单"文件"
   - 进入网站根目录（如：`/www/wwwroot/coffee.yourdomain.com/`）
   - 点击"上传"按钮
   - 选择本地的 `coffee-editor` 文件夹
   - 等待上传完成

#### 方法2：通过FTP上传
1. **获取FTP信息**
   - 宝塔面板 → 网站 → 设置 → FTP
   - 记录FTP地址、用户名、密码

2. **使用FTP工具**
   - 推荐使用：FileZilla、WinSCP
   - 连接服务器
   - 上传 `coffee-editor` 文件夹到网站根目录

### 第二步：安装Node.js环境

1. **安装Node.js版本管理器**
   - 宝塔面板 → 软件商店
   - 搜索"Node.js版本管理器"
   - 点击"安装"

2. **安装Node.js**
   - 进入"Node.js版本管理器"
   - 选择Node.js 16.x或18.x版本
   - 点击"安装"

3. **验证安装**
   - 宝塔面板 → 终端
   - 运行：`node --version`
   - 应该显示版本号

### 第三步：安装项目依赖

1. **进入网站目录**
   ```bash
   cd /www/wwwroot/您的域名/
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **验证安装**
   ```bash
   ls -la
   ```
   应该看到 `node_modules` 文件夹

### 第四步：启动服务

#### 方法1：使用PM2管理器（推荐）

1. **安装PM2管理器**
   - 宝塔面板 → 软件商店
   - 搜索"PM2管理器"
   - 点击"安装"

2. **添加项目**
   - 进入"PM2管理器"
   - 点击"添加项目"
   - 填写信息：
     - 项目名称：`coffee-editor`
     - 运行目录：`/www/wwwroot/您的域名/`
     - 启动文件：`server.js`
     - 端口：`3000`
   - 点击"提交"

3. **启动项目**
   - 在项目列表中点击"启动"
   - 状态应显示为"运行中"

#### 方法2：使用终端启动

1. **进入网站目录**
   ```bash
   cd /www/wwwroot/您的域名/
   ```

2. **启动服务**
   ```bash
   node server.js
   ```

3. **后台运行**
   ```bash
   nohup node server.js > app.log 2>&1 &
   ```

### 第五步：配置访问

#### 方法1：直接访问（简单）
- 访问地址：`http://您的域名:3000`
- 或：`http://您的服务器IP:3000`

#### 方法2：配置反向代理（推荐）

1. **设置反向代理**
   - 宝塔面板 → 网站 → 设置
   - 选择您的网站
   - 点击"反向代理"
   - 添加代理：
     - 代理名称：`coffee-editor`
     - 目标URL：`http://127.0.0.1:3000`
     - 发送域名：`$host`
   - 点击"提交"

2. **访问网站**
   - 现在可以通过 `http://您的域名` 访问
   - 无需指定端口号

### 第六步：配置SSL证书（可选但推荐）

1. **申请SSL证书**
   - 宝塔面板 → 网站 → 设置 → SSL
   - 选择"Let's Encrypt"免费证书
   - 点击"申请"

2. **强制HTTPS**
   - 申请成功后，开启"强制HTTPS"
   - 现在可以通过 `https://您的域名` 访问

## 🔧 常用管理命令

### PM2管理
```bash
# 查看所有项目
pm2 list

# 重启项目
pm2 restart coffee-editor

# 停止项目
pm2 stop coffee-editor

# 查看日志
pm2 logs coffee-editor

# 删除项目
pm2 delete coffee-editor
```

### 文件管理
```bash
# 进入网站目录
cd /www/wwwroot/您的域名/

# 查看文件
ls -la

# 查看日志
tail -f log/*.log

# 重启服务
pm2 restart coffee-editor
```

## 🛠️ 故障排除

### 常见问题

#### 1. 无法访问网站
- **检查端口**：确认3000端口是否开放
- **检查防火墙**：宝塔面板 → 安全 → 端口，添加3000端口
- **检查服务状态**：PM2管理器中查看项目状态

#### 2. 图片无法加载
- **检查权限**：确保img文件夹有读取权限
- **检查路径**：确认图片文件路径正确

#### 3. PDF生成失败
- **检查Node.js版本**：确保版本在16.x以上
- **检查内存**：确保服务器内存充足
- **查看日志**：检查PM2日志中的错误信息

#### 4. 日志文件无法保存
- **检查权限**：确保log文件夹有写入权限
- **创建文件夹**：手动创建log文件夹

### 日志查看
```bash
# 查看应用日志
pm2 logs coffee-editor

# 查看系统日志
tail -f /var/log/messages

# 查看Nginx日志
tail -f /www/wwwlogs/您的域名.log
```

## 📊 性能优化

### 服务器优化
1. **开启Gzip压缩**
   - 宝塔面板 → 网站 → 设置 → 性能优化
   - 开启Gzip压缩

2. **配置缓存**
   - 设置静态文件缓存时间
   - 配置浏览器缓存

3. **监控资源使用**
   - 定期检查CPU和内存使用率
   - 监控磁盘空间

### 应用优化
1. **定期清理日志**
   ```bash
   # 清理7天前的日志
   find /www/wwwroot/您的域名/log -name "*.log" -mtime +7 -delete
   ```

2. **监控服务状态**
   - 设置PM2自动重启
   - 配置服务监控

## 🔒 安全建议

1. **修改默认端口**
   - 修改宝塔面板默认端口
   - 使用强密码

2. **配置防火墙**
   - 只开放必要端口
   - 限制访问IP

3. **定期备份**
   - 备份网站文件
   - 备份数据库（如果有）

4. **更新系统**
   - 定期更新宝塔面板
   - 更新系统补丁

## 📞 技术支持

如果遇到问题，可以：
1. 查看宝塔面板日志
2. 检查PM2管理器状态
3. 查看应用日志文件
4. 联系服务器提供商

---

**部署完成后，您就可以通过浏览器访问您的咖啡名片编辑器了！** 🎉
