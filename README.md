# 咖啡名片批量编辑器

一个咖啡名片批量编辑和PDF生成工具，支持全局设定和单独设定模式。

## 功能特点

### 🖼️ 图片管理
- 图片从托管在 OSS 或 CDN（支持多种格式：JPG、PNG、GIF、BMP、WebP）
- 多选图片功能
- 每张图片独立设置制作数量

### 📝 文字编辑
- **烘焙日期**：使用日历控件，自动格式化为"烘焙日期：年月日"
- **重量**：数字输入，自动添加"g"单位
- **全局设定**：所有图片使用相同设置
- **单独设定**：每张图片的每个副本都可以设置不同的烘焙日期和重量

### 👁️ 预览功能
- 手动预览更新，避免输入时频繁刷新
- 1:1精确预览，与最终PDF完全一致
- 显示每个副本的独立预览
- 点击图片可放大查看

### 📄 PDF生成
- 无边距A4布局，2×4网格排列
- 自动添加2px黑色裁剪线，方便打印后裁剪
- 文件名自动使用当天日期格式（YYYY-MM-DD.pdf）

### 📊 日志记录
- 自动生成详细的log文件
- 保存到服务器`log/`文件夹
- 文件名带序号：YYYY-MM-DD-01.log（每天重置计数器）
- 包含完整的生成信息和图片详情

## 安装和运行

### 1. 安装依赖
```bash
npm install
```

### 2. 启动服务器
```bash
npm start
```

### 3. 访问应用
打开浏览器访问：http://localhost:3000

## 开发模式

使用nodemon进行开发：
```bash
npm run dev
```

## 打包网站

运行 '打包.bat'，在目录下生 coffee-editor


## API接口

### 保存日志
```
POST /api/save-log
Content-Type: application/json

{
  "filename": "2024-01-15.log",
  "content": "日志内容...",
  "logData": {...}
}
```

### 获取日志列表
```
GET /api/logs
```

### 下载日志文件
```
GET /api/logs/:filename
```

## 日志文件格式

日志文件包含以下详细信息：
- 生成时间和时间戳
- PDF文件名
- 设定模式（全局/单独）
- 图片数量和总制作数量
- PDF页数
- 每张图片的详细信息
- 全局设定或单独设定详情

## 技术栈

- **前端**：HTML5, CSS3, JavaScript (ES6+)
- **后端**：Node.js, Express
- **PDF生成**：jsPDF
- **图片处理**：Canvas API

## 🖼️ 动态图片加载功能

### 📁 图片文件夹管理
- **自动扫描**：系统启动时自动扫描`img/`文件夹中的所有图片
- **多格式支持**：支持JPG、PNG、GIF、BMP、WebP等常见图片格式
- **灵活命名**：图片文件名可以是任意名称，系统会自动识别和排序
- **实时更新**：添加或删除图片后，刷新页面即可看到变化
- **简洁显示**：自动忽略文件扩展名，只显示文件名主体部分

### 🔧 技术实现
- **服务器端API**：`GET /api/images` 获取图片文件列表
- **智能排序**：按文件名进行数字排序（1.jpg, 2.jpg, 10.jpg 会正确排序）
- **错误处理**：如果服务器API失败，会回退到预定义列表
- **格式验证**：只加载支持的图片格式文件

### 📝 使用示例
```
img/
├── 咖啡豆1.jpg          # 显示为：咖啡豆1
├── 咖啡豆2.jpg          # 显示为：咖啡豆2
├── 烘焙日期.png         # 显示为：烘焙日期
├── 重量标签.gif         # 显示为：重量标签
└── 其他图片.webp        # 显示为：其他图片
```

### 💡 显示名称优化
- **自动处理**：系统会自动移除文件扩展名，让界面更加简洁
- **保持功能**：文件扩展名仍然用于格式识别和加载
- **用户友好**：用户看到的是简洁的文件名，没有技术细节干扰

## 注意事项

1. 确保`img/`文件夹中有图片文件（支持JPG、PNG、GIF、BMP、WebP格式，文件名任意）
2. 服务器会自动创建`log/`文件夹
3. 如果服务器保存失败，log文件会自动下载到本地
4. PDF文件名使用当天日期，避免覆盖
5. 裁剪线为2px黑色实线，适合打印后裁剪
6. 单独设定模式下，每个副本都有独立的预览和设定
7. 支持超过8张图片的自动分页功能
8. Log文件按天编号，每天重置计数器

## 许可证

MIT License